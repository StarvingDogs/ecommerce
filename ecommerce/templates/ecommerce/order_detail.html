{% extends 'ecommerce/base.html' %}
{% block content %}
<div class="container mt-5">
  <h2>Order #{{ order.id }}</h2>
  <span class="badge bg-info">{{ order.status }}</span>
  <p class="mt-2"><strong>Date:</strong> {{ order.created_at|date:"Y-m-d H:i" }}</p>
  <ul class="list-group mb-3">
      {% for item in order.items.all %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            {{ item.product.name }} (x{{ item.quantity }})
          </div>
          <span>${{ item.price|floatformat:2 }}</span>
        </li>
      {% endfor %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <strong>Total</strong>
      <strong>${{ order.total|floatformat:2 }}</strong>
    </li>
  </ul>
  {% if has_reviewed %}
    <span class="badge bg-success mb-3">Order Reviewed</span>
    {% for review in order.reviews.all %}
      {% if review.customer == request.user.customer %}
        <div class="mb-2">
          
          {% comment %}
            This loop iterates 5 times (once for each character in "12345"), representing 5 stars.
            forloop.counter gives the current iteration number (1 to 5).
            If the current counter is less than or equal to the review's rating, it shows a filled star.
            Otherwise, it shows an empty star.
            This way, you always display 5 stars, with the correct number filled according to the review rating.
          {% endcomment %}

          {% for i in "12345" %}
            {% if forloop.counter <= review.rating %}
              <i class="bi bi-star-fill text-warning"></i>
            {% else %}
              <i class="bi bi-star text-warning"></i>
            {% endif %}
          {% endfor %}
          ({{ review.rating }} stars)
          <br>
          <strong>Comment:</strong> {{ review.comment }}
        </div>
      {% endif %}
    {% endfor %}
  {% else %}
    <a href="{% url 'ecommerce:leave_review' order.id %}" class="btn btn-outline-success mb-3">Leave Review for Order</a>
  {% endif %}
  {% if order.shippinginfo %}
  <div class="card my-4">
    <div class="card-header">Shipping Information</div>
    <div class="card-body">
      <p><strong>Address:</strong> {{ order.shippinginfo.address }}</p>
      <p><strong>City:</strong> {{ order.shippinginfo.city }}</p>
      <p><strong>Postal Code:</strong> {{ order.shippinginfo.postal_code }}</p>
      <p><strong>Country:</strong> {{ order.shippinginfo.country }}</p>
      <p><strong>Phone:</strong> {{ order.shippinginfo.phone }}</p>
    </div>
  </div>
  {% endif %}
  <a href="{% url 'ecommerce:order_history' %}" class="btn btn-secondary">Back to Order History</a>
  <a href="{% url 'ecommerce:product_list' %}" class="btn btn-primary">Back to Shop</a>
</div>
{% endblock %}
